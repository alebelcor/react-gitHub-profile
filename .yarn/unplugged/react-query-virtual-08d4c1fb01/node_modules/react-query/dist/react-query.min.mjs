import e from"react";function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var n,r,u={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(u[n]=e[n]);return u}const r=function(){function e(){}return e.prototype.then=function(t,n){const r=new e,o=this.s;if(o){const e=1&o?t:n;if(e){try{u(r,1,e(this.v))}catch(e){u(r,2,e)}return r}return this}return this.o=function(e){try{const o=e.v;1&e.s?u(r,1,t?t(o):o):n?u(r,1,n(o)):u(r,2,o)}catch(e){u(r,2,e)}},r},e}();function u(e,t,n){if(!e.s){if(n instanceof r){if(!n.s)return void(n.o=u.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(u.bind(null,e,t),u.bind(null,e,2));e.s=t,e.v=n;const o=e.o;o&&o(e)}}function o(e){return e instanceof r&&1&e.s}function i(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}function c(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function a(e,t){if(!t)return e&&e.then?e.then(p):Promise.resolve()}function f(e,t){return e&&e.then?e.then(t):t(e)}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function s(e,t){var n;do{var i=e();if(i&&i.then){if(!o(i)){n=!0;break}i=i.v}var c=t();if(o(c)&&(c=c.v),!c)return i}while(!c.then);const a=new r,f=u.bind(null,a,2);return(n?i.then(s):c.then(l)).then(void 0,f),a;function s(n){for(i=n;o(c=t())&&(c=c.v),c;){if(c.then)return void c.then(l).then(void 0,f);if((i=e())&&i.then){if(!o(i))return void i.then(s).then(void 0,f);i=i.v}}u(a,1,i)}function l(n){if(n){do{if((i=e())&&i.then){if(!o(i))return void i.then(s).then(void 0,f);i=i.v}if(o(n=t())&&(n=n.v),!n)return void u(a,1,i)}while(!n.then);n.then(l).then(void 0,f)}else u(a,1,i)}}function l(e,t){var n=e();return n&&n.then?n.then(t):t(n)}function d(e){var t=e();if(t&&t.then)return t.then(p)}function h(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function v(e,t){try{var n=e()}catch(e){return t(!0,e)}return n&&n.then?n.then(t.bind(null,!1),t.bind(null,!0)):t(!1,n)}function y(e,t){if(e)throw t;return t}function p(){}var g="idle",m="loading",b="error",w="success",q=0,S=function(){return q++},E={},F="undefined"==typeof window,O=function(){},I=console||{error:O,warn:O,log:O};function C(e){I=e}function T(t){var n=e.useRef();return n.current=t,e.useCallback((function(){return n.current}),[])}function M(e,t){return"function"==typeof e?e(t):e}function P(e,t){return D(t)?Object.assign.apply(Object,[{}].concat(Object.keys(t).sort().map((function(e){var n;return(n={})[e]=t[e],n})))):t}function j(e){return JSON.stringify(e,P)}function D(e){return e&&"object"==typeof e&&!Array.isArray(e)}function x(e,t){return e===t||typeof e==typeof t&&("object"==typeof e&&!Object.keys(t).some((function(n){return!x(e[n],t[n])})))}function k(){return"undefined"==typeof document||void 0===document.visibilityState||"visible"===document.visibilityState||"prerender"===document.visibilityState}function Q(e){if(D(e[0])){if(e[0].hasOwnProperty("queryKey")&&e[0].hasOwnProperty("queryFn")){var t=e[0],n=t.queryKey,r=t.variables,u=void 0===r?[]:r,o=t.queryFn,i=t.config;return[n,u,o,void 0===i?{}:i]}throw new Error("queryKey and queryFn keys are required.")}if("function"==typeof e[2]){var c=e[0],a=e[1],f=void 0===a?[]:a,s=e[2],l=e[3];return[c,f,s,void 0===l?{}:l]}var d=e[0],h=e[1],v=e[2];return[d,[],h,void 0===v?{}:v]}function R(t){var n=e.useRef(!1);return e[F?"useEffect":"useLayoutEffect"]((function(){return n.current=!0,function(){return n.current=!1}}),[]),e.useCallback((function(){return n.current?t.apply(void 0,arguments):void 0}),[t])}function A(e){if((e.config.suspense||e.config.useErrorBoundary)&&"error"===e.status)throw setTimeout((function(){e.query.state.status="loading"})),e.error;if(e.config.suspense&&"loading"===e.status)throw e.query.wasSuspended=!0,e.refetch()}var K=e.createContext(),H={current:{retry:3,retryDelay:function(e){return Math.min(1e3*Math.pow(2,e),3e4)},staleTime:0,cacheTime:3e5,refetchAllOnWindowFocus:!0,refetchInterval:!1,suspense:!1,queryKeySerializerFn:function e(t){if(!t)return[];if("function"==typeof t)try{return e(t())}catch(e){return[]}"string"==typeof t&&(t=[t]);var n=j(t);return t=JSON.parse(n),[n,t]},queryFnParamsFilter:function(e){return e},throwOnError:!1,useErrorBoundary:void 0,onMutate:O,onSuccess:O,onError:O,onSettled:O,refetchOnMount:!0,isDataEqual:function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){var r,u,o;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(u=r;0!=u--;)if(!e(t[u],n[u]))return!1;return!0}if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if((r=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(u=r;0!=u--;)if(!Object.prototype.hasOwnProperty.call(n,o[u]))return!1;for(u=r;0!=u--;){var i=o[u];if(!e(t[i],n[i]))return!1}return!0}return t!=t&&n!=n}}};function V(){return e.useContext(K)||H.current}function L(n){var r=n.config,u=n.children,o=e.useContext(K),i=e.useMemo((function(){var e=t({},o||H.current,{},r);return void 0===e.useErrorBoundary&&(e.useErrorBoundary=e.suspense),e}),[r,o]);return o||(H.current=i),e.createElement(K.Provider,{value:i},u)}var _=te(),B=e.createContext(_),G=[_];function W(){return e.useContext(B)}function z(t){var n=t.queryCache,r=t.children,u=e.useMemo((function(){return n||te()}),[n]);return e.useEffect((function(){return G.push(u),function(){var e=G.indexOf(u);e>=0&&G.splice(e,1),null==n&&u.clear()}}),[u,n]),e.createElement(B.Provider,{value:u},r)}var U={},J={},N={},X={},Y={},Z={},$={},ee={};function te(){var e=[],r={queries:{},isFetching:0},u=function(){r.isFetching=Object.values(r.queries).reduce((function(e,t){return t.state.isFetching?e+1:e}),0),e.forEach((function(e){return e(r)}))};r.subscribe=function(t){return e.push(t),function(){e.splice(e.indexOf(t),1)}},r.clear=function(){Object.values(r.queries).forEach((function(e){return e.clear()})),r.queries={},u()};var o=function(e,t){var n=(void 0===t?{}:t).exact;if("function"!=typeof e){var u=H.current.queryKeySerializerFn(e),o=u[0],i=u[1];e=function(e){return n?e.queryHash===o:x(e.queryKey,i)}}return Object.values(r.queries).filter(e)};return r.getQueries=o,r.getQuery=function(e){return o(e,{exact:!0})[0]},r.getQueryData=function(e){var t;return null==(t=r.getQuery(e))?void 0:t.state.data},r.removeQueries=function(e,t){var n=(void 0===t?{}:t).exact,i=o(e,{exact:n});i.forEach((function(e){clearTimeout(e.staleTimeout),delete r.queries[e.queryHash]})),i.length&&u()},r.cancelQueries=function(e,t){var n=(void 0===t?{}:t).exact,r=o(e,{exact:n});r.forEach((function(e){e.cancel()})),r.length&&u()},r.refetchQueries=i((function(e,t){var n=void 0===t?{}:t,u=n.exact,i=n.throwOnError,a=n.force,f=!0===e?Object.values(r.queries):o(e,{exact:u});return h((function(){return c(Promise.all(f.map((function(e){return e.fetch({force:a})}))))}),(function(e){if(i)throw e}))})),r._buildQuery=function(e,n,o,a){var f=a.queryKeySerializerFn(e),s=f[0],d=f[1],v=r.queries[s];return v?(Object.assign(v,{queryVariables:n,queryFn:o}),v.config=t({},v.config,{},a)):(v=function(e){var n=e.cache,o=e.config.queryReducer||ne,a=void 0===e.queryHash,f="function"==typeof e.config.initialData?e.config.initialData():e.config.initialData,s=void 0!==f,d=!!a||!s,v=e.config.manual,y=t({},e,{instances:[],state:o(void 0,{type:U,initialStatus:a||v||s?"success":"loading",initialData:f,hasInitialData:s,isStale:d,manual:v})}),p=function(e){y.state=o(y.state,e),y.instances.forEach((function(e){return e.onStateUpdate(y.state)})),u()};y.scheduleStaleTimeout=function(){y.config.staleTime!==1/0&&(y.staleTimeout=setTimeout((function(){n.getQuery(y.queryKey)&&p({type:N})}),y.config.staleTime))},y.scheduleGarbageCollection=function(){y.config.cacheTime!==1/0&&(p({type:X}),y.cacheTimeout=setTimeout((function(){r.removeQueries((function(e){return e.state.markedForGarbageCollection&&e.queryHash===y.queryHash}))}),void 0===y.state.data&&"error"!==y.state.status?0:y.config.cacheTime))},y.heal=function(){clearTimeout(y.cacheTimeout),y.cancelled=null},y.cancel=function(){y.cancelled=E,y.cancelPromises&&y.cancelPromises(),delete y.promise,u()},y.updateInstance=function(e){var n=y.instances.find((function(t){return t.id===e.id}));n?Object.assign(n,e):(n=t({onStateUpdate:O},e),y.instances.push(e))},y.subscribe=function(e){return y.heal(),function(){y.instances=y.instances.filter((function(t){return t.id!==e})),y.instances.length||(y.cancel(),y.scheduleGarbageCollection())}};var g=i((function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return h((function(){var t=e.apply(void 0,y.config.queryFnParamsFilter(n));return y.cancelPromises=function(){return null==t.cancel?void 0:t.cancel()},c(t,(function(e){if(delete y.cancelPromises,y.cancelled)throw y.cancelled;return e}))}),(function(t){var r=!1;if(delete y.cancelPromises,y.cancelled)throw y.cancelled;return p({type:J}),l((function(){if(!0===y.config.retry||y.state.failureCount<=y.config.retry||"function"==typeof y.config.retry&&y.config.retry(y.state.failureCount,t)){if(!k())return y.shouldContinueRetryOnFocus=!0,r=!0,new Promise(O);delete y.shouldContinueRetryOnFocus;var u=M(y.config.retryDelay,y.state.failureCount);return r=!0,c(new Promise((function(t,r){setTimeout(i((function(){return y.cancelled?r(y.cancelled):h((function(){return c(g.apply(void 0,[e].concat(n)),(function(e){if(y.cancelled)return r(y.cancelled);t(e)}))}),(function(e){if(y.cancelled)return r(y.cancelled);r(e)}))})),u)})))}}),(function(e){if(r)return e;throw t}))}))}));return y.fetch=i((function(e){var t=void 0===e?{}:e,n=t.force,r=t.__queryFn,u=void 0===r?y.queryFn:r;if(y.queryHash&&(y.state.isStale||n))return y.promise||(y.promise=i((function(){y.cancelled=null;var e=[].concat(y.instances);return y.wasSuspended&&e.unshift(y.suspenseInstance),h((function(){return p({type:Y}),c(g.apply(void 0,[u].concat(y.queryKey,y.queryVariables)),(function(t){return y.setData((function(e){return y.config.isDataEqual(e,t)?e:t})),e.forEach((function(e){return e.onSuccess&&e.onSuccess(y.state.data)})),e.forEach((function(e){return e.onSettled&&e.onSettled(y.state.data,null)})),delete y.promise,t}))}),(function(t){if(p({type:$,cancelled:t===y.cancelled,error:t}),delete y.promise,t!==y.cancelled)throw e.forEach((function(e){return e.onError&&e.onError(t)})),e.forEach((function(e){return e.onSettled&&e.onSettled(void 0,t)})),t}))}))()),y.promise})),y.setState=function(e){return p({type:ee,updater:e})},y.setData=function(e){p({type:Z,updater:e}),clearTimeout(y.staleTimeout),y.scheduleStaleTimeout()},y.clear=function(){clearTimeout(y.staleTimeout),clearTimeout(y.cacheTimeout),y.cancel()},y}({cache:r,queryKey:d,queryHash:s,queryVariables:n,queryFn:o,config:a}),!F&&v.state.data&&(v.scheduleStaleTimeout(),v.heal(),v.scheduleGarbageCollection()),v.queryHash&&(F||(r.queries[s]=v,setTimeout((function(){u()}))))),v},r.prefetchQuery=i((function(){for(var e=!1,u=arguments.length,o=new Array(u),i=0;i<u;i++)o[i]=arguments[i];var a=Q(o),f=a[0],s=a[1],d=a[2],v=a[3],y=v.force,p=n(v,["force"]);p=t({},H.current,{},p);var g=r._buildQuery(f,s,d,p);return l((function(){if(g.state.isStale||y)return h((function(){return c(g.fetch({force:y}),(function(t){return g.wasPrefetched=!0,e=!0,t}))}),(function(e){if(p.throwOnError)throw e}))}),(function(t){return e?t:g.state.data}))})),r.setQueryData=function(e,u,i){void 0===i&&(i={});var c=i,a=c.exact,f=n(c,["exact"]),s=o(e,{exact:a});s.length||"function"==typeof e||(s=[r._buildQuery(e,void 0,(function(){return new Promise(O)}),t({},H.current,{},f))]),s.forEach((function(e){return e.setData(u)}))},r}function ne(e,n){switch(n.type){case U:return{status:n.initialStatus,error:null,isFetching:!n.hasInitialData&&!n.manual&&"loading"===n.initialStatus,canFetchMore:!1,failureCount:0,isStale:n.isStale,markedForGarbageCollection:!1,data:n.initialData,updatedAt:n.hasInitialData?Date.now():0};case J:return t({},e,{failureCount:e.failureCount+1});case N:return t({},e,{isStale:!0});case X:return t({},e,{markedForGarbageCollection:!0});case Y:return t({},e,{status:"error"===e.status?"loading":e.status,isFetching:!0,failureCount:0});case Z:return t({},e,{status:"success",data:M(n.updater,e.data),error:null,isStale:!1,isFetching:!1,canFetchMore:n.canFetchMore,updatedAt:Date.now(),failureCount:0});case $:return t({},e,{isFetching:!1,isStale:!0},!n.cancelled&&{status:"error",error:n.error});case ee:return M(n.updater,e);default:throw new Error}}var re,ue=function(){var e=H.current.refetchAllOnWindowFocus;k()&&(void 0===navigator.onLine||navigator.onLine)&&G.forEach((function(t){return t.refetchQueries((function(t){return!!t.instances.length&&(!0!==t.config.manual&&(t.shouldContinueRetryOnFocus?(delete t.promise,!0):void 0===t.config.refetchOnWindowFocus?e:t.config.refetchOnWindowFocus))})).catch(I.error)}))};function oe(e){re&&re(),re=e(ue)}function ie(){var t=W(),n=e.useState({}),r=n[0],u=n[1];return e.useEffect((function(){return t.subscribe((function(){return u({})}))}),[]),e.useMemo((function(){return r&&t.isFetching}),[r])}oe((function(e){var t;if(!F&&(null==(t=window)?void 0:t.addEventListener))return window.addEventListener("visibilitychange",e,!1),window.addEventListener("focus",e,!1),function(){window.removeEventListener("visibilitychange",e),window.removeEventListener("focus",e)}}));var ce=function(){return{status:"idle",data:void 0,error:null}},ae={},fe={},se={},le={};function de(e,t){if(t.type===ae)return{status:"idle",data:void 0,error:null};if(t.type===fe)return{status:"loading"};if(t.type===se)return{status:"success",data:t.data};if(t.type===le)return{status:"error",error:t.error};throw new Error}function he(n,r){void 0===r&&(r={});var u=e.useReducer(de,null,ce),o=u[0],f=R(u[1]),s=T(n),d=T(t({},V(),{},r)),v=e.useRef(),y=e.useCallback(i((function(e,t){var n=void 0===t?{}:t,r=n.onSuccess,u=void 0===r?O:r,o=n.onError,y=void 0===o?O:o,p=n.onSettled,g=void 0===p?O:p,m=n.throwOnError,b=d(),w=S();v.current=w;var q,E=i((function(){return v.current===w}));return f({type:fe}),h((function(){return c(b.onMutate(e),(function(t){var n;return q=t,l((function(){if(E())return c(s()(e),(function(e){n=e}))}),(function(){return l((function(){if(E())return a(u(n,e))}),(function(){return l((function(){if(E())return a(b.onSuccess(n,e))}),(function(){return l((function(){if(E())return a(g(n,null,e))}),(function(){return l((function(){if(E())return a(b.onSettled(n,null,e))}),(function(){return E()&&f({type:se,data:n}),n}))}))}))}))}))}))}),(function(t){return l((function(){if(E())return I.error(t),a(y(t,e,q))}),(function(){return l((function(){if(E())return a(b.onError(t,e,q))}),(function(){return l((function(){if(E())return a(g(void 0,t,e,q))}),(function(){return l((function(){if(E())return a(b.onSettled(void 0,t,e,q))}),(function(){if(E()&&(f({type:le,error:t}),null!=m?m:b.throwOnError))throw t}))}))}))}))}))})),[f,d,s]),p=e.useCallback((function(){return f({type:ae})}),[f]);return e.useEffect((function(){if(d().useErrorBoundary&&o.error)throw o.error}),[d,o.error]),[y,t({},o,{reset:p})]}function ve(r,u,o,a){void 0===a&&(a={});var f,s=(null===(f=e.useRef(null)).current&&(f.current=S()),f.current);a=t({},V(),{},a);var l=W(),d=e.useRef(),v=l._buildQuery(r,u,o,a);d.current&&void 0===d.current.queryHash&&void 0===v.queryHash||(d.current=v);var y=d.current,p=R(e.useState()[1]),g=T(a),m=e.useCallback(i((function(e){void 0===e&&(e={});var t=e,r=t.throwOnError,u=n(t,["throwOnError"]);return h((function(){return c(y.fetch(u))}),(function(e){if(r)throw e}))})),[y]);return y.suspenseInstance={onSuccess:function(e){return g().onSuccess(e)},onError:function(e){return g().onError(e)},onSettled:function(e,t){return g().onSettled(e,t)}},e.useEffect((function(){return y.updateInstance({id:s,onStateUpdate:function(){return p({})},onSuccess:function(e){return g().onSuccess(e)},onError:function(e){return g().onError(e)},onSettled:function(e,t){return g().onSettled(e,t)}}),y.subscribe(s)}),[g,s,y,p]),e.useEffect((function(){g().manual||y.wasPrefetched||y.wasSuspended||!y.state.isStale||!g().refetchOnMount&&1!==y.instances.length||m().catch(I.error),y.wasPrefetched=!1,y.wasSuspended=!1}),[g,y,m]),e.useEffect((function(){var e=d.current;if(a.refetchInterval&&(!e.currentRefetchInterval||a.refetchInterval<e.currentRefetchInterval))return e.currentRefetchInterval=a.refetchInterval,clearInterval(e.refetchIntervalId),e.refetchIntervalId=setInterval((function(){(k()||a.refetchIntervalInBackground)&&m().catch(I.error)}),a.refetchInterval),function(){clearInterval(e.refetchIntervalId),delete e.refetchIntervalId,delete e.currentRefetchInterval}}),[a.refetchInterval,a.refetchIntervalInBackground,m]),t({},y.state,{config:a,query:y,refetch:m})}function ye(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=ve.apply(void 0,Q(t));return A(r),r}function pe(){for(var n=arguments.length,r=new Array(n),u=0;u<n;u++)r[u]=arguments[u];var o=Q(r),i=o[0],c=o[1],a=o[2],f=o[3],s=void 0===f?{}:f,l=e.useRef();i||(l.current=void 0),void 0!==l.current&&delete s.initialData;var d=ve(i,c,a,s),h=d.data,v=d.status;e.useEffect((function(){"success"===v&&void 0!==h&&(l.current=h)}),[h,v]);var y=h;return void 0===y&&(y=l.current),void 0!==y&&(v="success"),A(d),t({},d,{resolvedData:y,latestData:h,status:v})}function ge(){for(var n=e.useRef(),r=arguments.length,u=new Array(r),o=0;o<r;o++)u[o]=arguments[o];var a=Q(u),l=a[0],h=a[1],p=a[2],g=a[3],m=void 0===g?{}:g,b=m.getFetchMore,w=T(b),q=p,S=ve(l,h,p=i((function(){var e=!1,t=[],r=[].concat(n.current.query.pageVariables),u=[];return f(s((function(){var n=r.shift();return d((function(){if(t.length){var r=w()(t[t.length-1],t);if(!r)return void(e=!0);var o=[].concat(n.slice(0,-1),[r]),i=t.push;return c(q.apply(void 0,o),(function(e){i.call(t,e),u.push(o)}))}var a=t.push;return c(q.apply(void 0,n),(function(e){a.call(t,e),u.push(n)}))}))}),(function(){return!e&&!!r.length})),(function(){return n.current.query.canFetchMore=w()(t[t.length-1],t),n.current.query.pageVariables=u,t}))})),m);void 0===S.query.canFetchMore&&void 0!==S.data&&(S.query.canFetchMore=w()(S.data[S.data.length-1],S.data)),n.current=S;var E=S.refetch,F=S.data,O=void 0===F?[]:F,I=S.query.canFetchMore;S.query.pageVariables||(S.query.pageVariables=[[].concat(S.query.queryKey,S.query.queryVariables)]);var C=e.useCallback((function(e){return void 0===e&&(e=n.current.query.canFetchMore),n.current.query.canFetchMore?E({force:!0,__queryFn:i((function(){for(var r=arguments.length,u=new Array(r),o=0;o<r;o++)u[o]=arguments[o];return v((function(){n.current.query.setState((function(e){return t({},e,{isFetchingMore:!0})}));var r=[].concat(u,[e]);n.current.query.pageVariables.push(r);var o=n.current.data;return c(q.apply(void 0,r),(function(e){var t=[].concat(o,[e]);return n.current.query.canFetchMore=w()(t[t.length-1],t),t}))}),(function(e,r){return n.current.query.setState((function(e){return t({},e,{isFetchingMore:!1})})),y(e,r)}))}))}):void 0}),[w,q,E]);return A(S),t({},S,{data:O,canFetchMore:I,fetchMore:C})}export{z as ReactQueryCacheProvider,L as ReactQueryConfigProvider,x as deepIncludes,te as makeQueryCache,_ as queryCache,C as setConsole,oe as setFocusHandler,j as stableStringify,b as statusError,g as statusIdle,m as statusLoading,w as statusSuccess,ge as useInfiniteQuery,ie as useIsFetching,he as useMutation,pe as usePaginatedQuery,ye as useQuery,W as useQueryCache};
//# sourceMappingURL=react-query.min.mjs.map
